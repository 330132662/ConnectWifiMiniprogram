var _0x4c9d=['match','log','splice','services','蓝牙发送长度','toString','value','uuid','charCodeAt','replace','0000180A','pop','map','1F78010288','devices','5682904137','length','00001801','1F78010388','deviceId','1F710088','characteristics','call','DPI','onBLEConnectionStateChange','properties','createBLEConnection','platform','getSystemInfo','indexOf','errMsg','toUpperCase','closeBluetoothAdapter','getBLEDeviceServices','closeBLEConnection','buffer','substr','split','push','exports','notify\x20\x20\x20\x20','Sertvice\x20\x20','write\x20\x20\x20\x20\x20','getBLEDeviceCharacteristics','exec','android','ios','width','writeBLECharacteristicValue','setBLEMTU','charAt','00002A24','substring'];var _0x4524=function(_0x4c9d9a,_0x452477){_0x4c9d9a=_0x4c9d9a-0x0;var _0x6b1421=_0x4c9d[_0x4c9d9a];return _0x6b1421;};const sDeTongCheckSum=_0x4524('0xf');var maxSendDataLength=0x78;var sendDataWaitTime=0x14;var connectedDeviceId='';var connectedDevicServiceId='';var deviceInfoServiceId='';var writeCharacteristicsId='';var notifyCharacteristicsId='';var interval=null;var printList=[];var supportPrefixKeys=[];var printHex='';var sDidSendDataHandler;var sDidSendHexHandler;var sDidConnectedHandler;var currentPrinter={'name':'','DPI':0xcb,'width':0x180};module[_0x4524('0x27')]={'setSupportPrefixs':setSupportPrefixs,'startScanPeripherals':startScanPeripherals,'stopScanPeripherals':stopScanPeripherals,'connectPeripheral':connectPeripheral,'disconnectPeripheral':disconnectPeripheral,'scanedPeripherals':scanedPeripherals,'sendData':sendData,'currentConnectedDeviceId':currentConnectedDeviceId,'currentPrinterInfo':currentPrinterInfo,'setCurrentPrinterInfoProperty':setCurrentPrinterInfoProperty};function currentPrinterInfo(){return currentPrinter;}function setCurrentPrinterInfoProperty(_0x4269ee,_0x361752){currentPrinter[_0x4269ee]=_0x361752;}function setSupportPrefixs(_0x38e030){supportPrefixKeys=_0x38e030;}function startScanPeripherals(_0x3b293c){wx[_0x4524('0x20')]({'success':_0x120f29=>{wx['openBluetoothAdapter']({'success':function(_0xb1163d){wx['startBluetoothDevicesDiscovery']({'success':function(_0xc362f3){setTimeout(function(){scanedPeripherals(function(_0x3431dc){if(_0x3b293c){_0x3b293c(_0x3431dc);}});},0x7d0);}});wx['onBluetoothAdapterStateChange'](function(_0x4e46b2){});}});}});}function currentConnectedDeviceId(){return connectedDeviceId?connectedDeviceId:'';}function stopScanPeripherals(){wx['stopBluetoothDevicesDiscovery']({'success':function(_0x34ad04){}});}function connectPeripheral(_0x5bb205,_0x410296,_0x3362e5){sDidConnectedHandler=_0x410296;wx[_0x4524('0x18')](function(_0x50e6fb){if(_0x50e6fb[_0x4524('0x13')]!=connectedDeviceId){return;}if(!_0x50e6fb['connected']){if(_0x3362e5){_0x3362e5();}}});wx['onBLECharacteristicValueChange'](function(_0x2dc991){if(_0x2dc991['deviceId']!=connectedDeviceId){return;}if(_0x2dc991['characteristicId']['indexOf'](_0x4524('0x33'))==0x0){parseDeviceInfo(_0x2dc991);}else if(_0x2dc991['characteristicId']==notifyCharacteristicsId){var _0x17c67e=new Uint8Array(_0x2dc991['value']);if(_0x17c67e['length']>0x2&&_0x17c67e[0x0]==0x1f){if(_0x17c67e[0x1]==0x71){parseDPI(_0x17c67e);}else if(_0x17c67e[0x1]==0x72){parsePrintWidth(_0x17c67e);}else if(_0x17c67e[0x1]==0x77){parseBufferSize(_0x17c67e);}}}});stopScanPeripherals();wx[_0x4524('0x1a')]({'deviceId':_0x5bb205,'success':function(_0x12c1a7){connectedDeviceId=_0x5bb205;connectedDevicServiceId=null;deviceInfoServiceId=null;notifyCharacteristicsId=null;writeCharacteristicsId=null;wx[_0x4524('0x21')]({'deviceId':connectedDeviceId,'success':function(_0x5805ac){var _0x113f71=_0x5805ac[_0x4524('0x3')];for(var _0x56e46a=0x0;_0x56e46a<_0x113f71['length'];_0x56e46a++){var _0x19e5fc=_0x5805ac[_0x4524('0x3')][_0x56e46a]['uuid'];if(connectedDevicServiceId==null&&_0x19e5fc[_0x4524('0x1d')]('F000FFC0')!=0x0&&_0x19e5fc[_0x4524('0x1d')]('000018F0')!=0x0&&_0x19e5fc['indexOf']('00001800')!=0x0&&_0x19e5fc[_0x4524('0x1d')](_0x4524('0xa'))!=0x0&&_0x19e5fc[_0x4524('0x1d')](_0x4524('0x11'))!=0x0){connectedDevicServiceId=_0x19e5fc;}if(_0x19e5fc['indexOf']('0000180A')==0x0){deviceInfoServiceId=_0x19e5fc;}}console[_0x4524('0x1')](_0x4524('0x29')+connectedDevicServiceId);wx[_0x4524('0x2b')]({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'success':function(_0x4e0251){for(var _0x47321d=0x0;_0x47321d<_0x4e0251['characteristics'][_0x4524('0x10')];_0x47321d++){if(_0x4e0251[_0x4524('0x15')][_0x47321d][_0x4524('0x19')]['notify']){if(notifyCharacteristicsId==null&&_0x4e0251['characteristics'][_0x47321d][_0x4524('0x7')]['indexOf']('0000FF03')!=0x0){notifyCharacteristicsId=_0x4e0251['characteristics'][_0x47321d][_0x4524('0x7')];}}if(writeCharacteristicsId==null&&_0x4e0251['characteristics'][_0x47321d][_0x4524('0x19')]['write']){writeCharacteristicsId=_0x4e0251[_0x4524('0x15')][_0x47321d][_0x4524('0x7')];}}console[_0x4524('0x1')](_0x4524('0x28')+notifyCharacteristicsId);console['log'](_0x4524('0x2a')+writeCharacteristicsId);wx['notifyBLECharacteristicValueChange']({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'characteristicId':notifyCharacteristicsId,'state':!![],'success':function(_0x3bd08b){}});console['log']('info\x20\x20\x20\x20\x20\x20'+deviceInfoServiceId);wx[_0x4524('0x2b')]({'deviceId':connectedDeviceId,'serviceId':deviceInfoServiceId,'success':function(_0x1582e3){for(var _0x3e56ad=0x0;_0x3e56ad<_0x1582e3['characteristics'][_0x4524('0x10')];_0x3e56ad++){if(_0x1582e3['characteristics'][_0x3e56ad]['uuid'][_0x4524('0x1d')]('00002A24')==0x0){wx['readBLECharacteristicValue']({'characteristicId':_0x1582e3['characteristics'][_0x3e56ad]['uuid'],'deviceId':connectedDeviceId,'serviceId':deviceInfoServiceId});break;}}},'fail':function(){console['log']('获取蓝牙模块信息失败');if(_0x3362e5){_0x3362e5();}},'complete':function(){}});},'fail':function(){console[_0x4524('0x1')]('获取特征值失败');if(_0x3362e5){_0x3362e5();}},'complete':function(){}});}});},'fail':function(_0x1d9015){console['log']('连接蓝牙设备失败',_0x1d9015['errCode'],_0x1d9015[_0x4524('0x1e')]);if(_0x3362e5){_0x3362e5();}},'complete':function(){}});}function parseDeviceInfo(_0x3c63fd){var _0x4e67ca=bin2String(_0x3c63fd[_0x4524('0x6')]);maxSendDataLength=0xb4;sendDataWaitTime=0x21;var _0x4ccb9f=_0x4e67ca[_0x4524('0x25')]('-');if(_0x4ccb9f[_0x4524('0x10')]>0x0){var _0x35a928=_0x4ccb9f[_0x4524('0xb')]();_0x35a928=_0x35a928['toUpperCase']();if(_0x35a928=='MT_DF1'){maxSendDataLength=0x78;sendDataWaitTime=0x14;}else if(_0x35a928[_0x4524('0x1d')]('DF')==0x0){_0x35a928=_0x35a928[_0x4524('0x9')]('DF','');var _0x210ff5=parseInt(_0x35a928,0x10);if(_0x210ff5&0x1){maxSendDataLength=0xb4;sendDataWaitTime=0x12;}else if(_0x210ff5&0x2){maxSendDataLength=0x78;sendDataWaitTime=0x14;}else if(_0x210ff5&0x4){maxSendDataLength=0xf0;sendDataWaitTime=0x1;}}}console['log'](_0x4524('0x4')+maxSendDataLength);checkDPI();}function parseDPI(_0xb01bd7){var _0x266533=0x0;var _0x4d2c0c=_0xb01bd7[0x2];if(_0x4d2c0c==0x1){_0x266533=_0xb01bd7[0x3];}else{var _0x28ca4a=_0xb01bd7[0x3];var _0x28b53c=_0xb01bd7[0x4];_0x266533=(_0x28ca4a<<0x8)+_0x28b53c;}currentPrinter[_0x4524('0x17')]=_0x266533;checkPrintWidth();}function parsePrintWidth(_0x298306){var _0xeb37c1=_0x298306[0x3];var _0x26a9cd=_0x298306[0x4];var _0x55c8a0=(_0xeb37c1<<0x8)+_0x26a9cd;currentPrinter[_0x4524('0x2f')]=_0x55c8a0;wx[_0x4524('0x1c')]({'success':function(_0x255b51){if(_0x255b51[_0x4524('0x1b')]==_0x4524('0x2e')){checkDeviceType(!![]);if(sDidConnectedHandler){sDidConnectedHandler();}}else if(_0x255b51[_0x4524('0x1b')]==_0x4524('0x2d')){checkDeviceType(![]);if(sDidConnectedHandler){sDidConnectedHandler();}wx[_0x4524('0x31')]({'deviceId':connectedDeviceId,'mtu':0x200});}}});}function parseBufferSize(_0x33d2a6){var _0x5d9383=0x0;var _0x12edd7=_0x33d2a6[0x3];if(_0x12edd7>=0xc0){var _0xbc8196=_0x33d2a6[0x3];var _0x1091f7=_0x33d2a6[0x4];_0x5d9383=(_0xbc8196<<0x8)+_0x1091f7;}else{_0x5d9383=_0x12edd7;}postDatasWithBuffer(_0x5d9383*0x1f4);}function disconnectPeripheral(){wx[_0x4524('0x22')]({'deviceId':connectedDeviceId,'success':function(_0x271069){}});}function scanedPeripherals(_0x1a7fc3){wx['getBluetoothDevices']({'success':function(_0x48dc3d){var _0x3f52c0=new Array();for(var _0x5a582c=0x0;_0x5a582c<_0x48dc3d['devices']['length'];_0x5a582c++){var _0x333ca9=_0x48dc3d['devices'][_0x5a582c]['name'];if(isMyPrinterForName(_0x333ca9)){_0x3f52c0['push'](_0x48dc3d[_0x4524('0xe')][_0x5a582c]);}}if(_0x1a7fc3){_0x1a7fc3(_0x3f52c0);}}});}function sendData(_0x351c6d,_0x2e1da4){if(printList==null){printList=new Array();}if(_0x351c6d!=null){printList[_0x4524('0x26')](_0x351c6d);if(printList['length']>0x0){var _0x49ec42=printList[0x0];if(_0x49ec42[_0x4524('0x10')]>0x0){sDidSendDataHandler=_0x2e1da4;checkBufferSize();}else{clearInterval(interval);printList['splice'](0x0,0x1);if(_0x2e1da4){_0x2e1da4();}}}}}function postDatasWithBuffer(_0x2bc24d){if(_0x2bc24d<0x7d0){setTimeout(()=>{checkBufferSize();},0x32);}else{printHex='';var _0x439b55=printList[0x0];if(_0x439b55!=null){for(;_0x439b55[_0x4524('0x10')]>0x0;_0x439b55[_0x4524('0x2')](0x0,0x1)){var _0x52e3ce=_0x439b55[0x0];if(printHex[_0x4524('0x10')]+_0x52e3ce[_0x4524('0x10')]>=_0x2bc24d){break;}printHex+=_0x52e3ce;}}postHexValue(function(){if(_0x439b55!=null&&_0x439b55[_0x4524('0x10')]>0x0){checkBufferSize();}else{printList[_0x4524('0x2')](0x0,0x1);if(sDidSendDataHandler){sDidSendDataHandler();}}});}}function postHexValue(_0x1fe38a){sDidSendHexHandler=_0x1fe38a;postHex();}function postHex(){if(printHex!=null&&printHex['length']>0x0){interval=setTimeout(function(){var _0x2b7787;if(printHex!=null&&printHex['length']>maxSendDataLength){_0x2b7787=printHex[_0x4524('0x24')](0x0,maxSendDataLength);printHex=printHex[_0x4524('0x34')](maxSendDataLength);}else{_0x2b7787=printHex;printHex='';}if(_0x2b7787&&_0x2b7787['length']>0x0){var _0x394688=new Uint8Array(_0x2b7787[_0x4524('0x0')](/[\da-f]{2}/gi)[_0x4524('0xc')](function(_0x30de81){return parseInt(_0x30de81,0x10);}));wx[_0x4524('0x30')]({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'characteristicId':writeCharacteristicsId,'value':_0x394688['buffer'],'success':function(_0x4926f5){}});}postHex();},sendDataWaitTime);}else{if(sDidSendHexHandler){sDidSendHexHandler();}}}function checkDeviceType(_0x1403d4){if(_0x1403d4){sendCMD(_0x4524('0x12'));}else{sendCMD(_0x4524('0xd'));}}function checkDPI(){sendCMD(_0x4524('0x14'));}function checkPrintWidth(){sendCMD('1F720088');}function checkBufferSize(){sendCMD('1F770088');}function sendCMD(_0xef89fe){var _0x16fc3e=_0xef89fe;var _0x3e351b=new Uint8Array(_0x16fc3e[_0x4524('0x0')](/[\da-f]{2}/gi)[_0x4524('0xc')](function(_0x1b29dc){return parseInt(_0x1b29dc,0x10);}));wx['writeBLECharacteristicValue']({'deviceId':connectedDeviceId,'serviceId':connectedDevicServiceId,'characteristicId':writeCharacteristicsId,'value':_0x3e351b[_0x4524('0x23')],'success':function(_0x24c4fb){}});}function ab2hex(_0x10d340){var _0x4e2444=Array['prototype'][_0x4524('0xc')][_0x4524('0x16')](new Uint8Array(_0x10d340),function(_0x2bd8f0){return('00'+_0x2bd8f0[_0x4524('0x5')](0x10))['slice'](-0x2);});return _0x4e2444['join'](',');}function bin2String(_0x4be34a){var _0x3958f8=new Uint8Array(_0x4be34a);var _0x420262='';for(var _0xbeb157=0x0;_0xbeb157<_0x3958f8['length'];_0xbeb157++){_0x420262+=String['fromCharCode'](_0x3958f8[_0xbeb157]);}return _0x420262;}function isMyPrinterForName(_0xadf89){if(_0xadf89==null||_0xadf89[_0x4524('0x10')]==0x0){return![];}var _0x27abe2=_0xadf89[_0x4524('0x1f')]();var _0x3646c4=_0x27abe2['split']('-');if(_0x3646c4['length']>0x1){_0x27abe2=_0x3646c4[_0x3646c4['length']-0x1];if(_0x27abe2['length']<0x8){return![];}}else{return![];}var _0x7e0458=new RegExp('^[A-Z]{0,2}[0-9]{4,5}[0-9A-Z]{2,3}[0-9]{2}$','g');if(!_0x7e0458[_0x4524('0x2c')](_0x27abe2)){return![];}var _0x166633=new RegExp('^[0-9]+','g');var _0xbde453=_0x166633[_0x4524('0x2c')](_0x27abe2);var _0x42533d='';var _0x5bd705=0x0;if(_0x27abe2[_0x4524('0x32')](0x1)<'0'||_0x27abe2['charAt'](0x1)>'9'){_0x42533d=_0x27abe2[_0x4524('0x34')](0x0,0x2);_0x27abe2=_0x27abe2[_0x4524('0x34')](0x2,_0x27abe2[_0x4524('0x10')]);_0x5bd705+=_0x42533d[_0x4524('0x8')](0x0)*0xb;_0x5bd705+=_0x42533d[_0x4524('0x8')](0x1)*0xc;}else if(_0x27abe2[_0x4524('0x32')](0x0)<'0'||_0x27abe2['charAt'](0x0)>'9'){_0x42533d=_0x27abe2[_0x4524('0x34')](0x0,0x1);_0x27abe2=_0x27abe2['substring'](0x1,_0x27abe2[_0x4524('0x10')]);_0x5bd705+=_0x42533d[_0x4524('0x8')](0x0)*0x11;}if(_0x42533d['toUpperCase']()=='D'||_0x42533d[_0x4524('0x1f')]()=='O'){}else if(_0x27abe2[_0x4524('0x10')]<0x8){return![];}else{if(supportPrefixKeys[_0x4524('0x10')]>0x0){for(var _0x126143=0x0;_0x126143<supportPrefixKeys['length'];_0x126143++){var _0x124562=supportPrefixKeys[_0x126143];if(_0x124562[_0x4524('0x10')]>0x0){var _0x34bc3c=_0x27abe2[_0x4524('0x34')](0x0,_0x124562[_0x4524('0x10')]);if(_0x34bc3c[_0x4524('0x1f')]()==_0x124562[_0x4524('0x1f')]()){break;}}else{return![];}}}}if(!_0xbde453||_0x27abe2['length']>=0x9||_0x27abe2[_0x4524('0x32')](0x3)!='0'){if(_0xbde453){_0x5bd705+=(_0x27abe2[_0x4524('0x32')](0x0)-'0')*0x2;_0x5bd705+=(_0x27abe2[_0x4524('0x32')](0x1)-'0')*0x3;_0x5bd705+=(_0x27abe2['charAt'](0x2)-'0')*0x5;for(var _0x126143=0x4;_0x126143<_0x27abe2['length'];++_0x126143){_0x5bd705+=(_0x27abe2['charAt'](_0x126143)-'0')*((_0x126143&0x1)==0x0?0x7:0x9);}}else{_0x5bd705+=_0x27abe2[_0x4524('0x32')](0x0)*0x2;_0x5bd705+=_0x27abe2[_0x4524('0x32')](0x1)*0x3;_0x5bd705+=_0x27abe2['charAt'](0x2)*0x5;for(var _0x126143=0x4;_0x126143<_0x27abe2[_0x4524('0x10')];++_0x126143){_0x5bd705+=_0x27abe2['charCodeAt'](_0x126143)*((_0x126143&0x1)==0x0?0x7:0x9);}}var _0x33eeff=_0x5bd705%0xa;if(sDeTongCheckSum['charAt'](_0x33eeff)!=_0x27abe2['charAt'](0x3)){return![];}}return!![];}